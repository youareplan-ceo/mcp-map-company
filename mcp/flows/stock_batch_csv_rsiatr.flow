name: stock_batch_csv_rsiatr
steps:
  - tool: portfolio
    action: batch_sma
    args:
      csv_path: "data/tickers.csv"
      period: "3mo"
      interval: "1d"
      fast: 5
      slow: 20
      # ê¸°ë³¸ í•„í„° (ì›í•˜ì‹œë©´ ì¡°ì •)
      min_last_close: 50
      min_avg_vol20: 1000000
      min_rsi: 40
      max_rsi: 80
      min_atr_pct: 0.5
      max_atr_pct: 6.0

  - gate: manual_approval

  - agent: notifier
    task: summary_to_slack
    args:
      text: |
        ğŸ“Š StockPilot CSV(ì§€í‘œí•„í„°) ê²°ê³¼ (ì…ë ¥ {{ portfolio.count }} ì¢…ëª©)
        âœ… í†µê³¼/ì‹ í˜¸ ìƒìœ„:
        {% for r in portfolio.results if not r.get("filtered") and not r.get("error") %}{% if loop.index <= 15 %}
        - {{ r.ticker }} | ì¢…ê°€: {{ r.last_close }} | RSI14: {{ r.rsi14|round(1) if r.rsi14 else "-" }} | ATR%: {{ r.atr_pct|round(2) if r.atr_pct else "-" }} | ì‹ í˜¸: {{ r.signal }} {{ r.crossed if r.crossed else "" }} | 5/20MA: {{ r.fast_ma|round(2) if r.fast_ma else "-" }}/{{ r.slow_ma|round(2) if r.slow_ma else "-" }} | ê±°ë˜ëŸ‰20: {{ r.avg_vol20 }}
        {% endif %}{% endfor %}
        ğŸ” í•„í„° ì œì™¸:
        {% for r in portfolio.results if r.get("filtered") %}{% if loop.index <= 15 %}
        - {{ r.ticker }} | ì œì™¸ì´ìœ : {{ r.filtered }} | ì¢…ê°€: {{ r.last_close if r.last_close is not none else "-" }} | RSI14: {{ r.rsi14 if r.rsi14 is not none else "-" }} | ATR%: {{ r.atr_pct|round(2) if r.atr_pct else "-" }}
        {% endif %}{% endfor %}
