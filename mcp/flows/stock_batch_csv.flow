name: stock_batch_csv
steps:
  - tool: portfolio
    action: batch_sma
    args:
      csv_path: "data/tickers.csv"
      # tickers: ["AAPL"]  # í•„ìš”ì‹œ ìˆ˜ë™ ì¶”ê°€ë„ ê°€ëŠ¥
      period: "3mo"
      interval: "1d"
      fast: 5
      slow: 20
      min_last_close: 50
      min_avg_vol20: 1000000

  - gate: manual_approval

  - agent: notifier
    task: summary_to_slack
    args:
      text: |
        ğŸ“Š StockPilot CSV ë°°ì¹˜ ê²°ê³¼ (ì´ {{ portfolio.count }} ì¢…ëª© ì…ë ¥)
        âœ… í†µê³¼/ì‹ í˜¸ ìƒìœ„:
        {% for r in portfolio.results if not r.get("filtered") and not r.get("error") %}{% if loop.index <= 12 %}
        - {{ r.ticker }} | ì¢…ê°€: {{ r.last_close }} | 5MA: {{ r.fast_ma }} | 20MA: {{ r.slow_ma }} | ì‹ í˜¸: {{ r.signal }} {{ r.crossed if r.crossed else "" }} | ê±°ë˜ëŸ‰20: {{ r.avg_vol20 }}
        {% endif %}{% endfor %}
        ğŸ” í•„í„°ë¡œ ì œì™¸:
        {% for r in portfolio.results if r.get("filtered") %}{% if loop.index <= 12 %}
        - {{ r.ticker }} | ì´ìœ : {{ r.filtered }} | ì¢…ê°€: {{ r.last_close if r.last_close is not none else "-" }} | ê±°ë˜ëŸ‰20: {{ r.avg_vol20 if r.avg_vol20 is not none else "-" }}
        {% endif %}{% endfor %}
