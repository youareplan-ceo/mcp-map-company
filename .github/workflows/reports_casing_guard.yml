name: REPORTS Casing Guard

on:
  pull_request:
    branches: [ main ]
    types: [ opened, synchronize, reopened, ready_for_review ]
  workflow_dispatch:
    # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©

jobs:
  casing-guard:
    runs-on: ubuntu-latest
    name: "ì†Œë¬¸ì reports/ ê²½ë¡œ ì°¨ë‹¨"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ í•„ìš”

      - name: Run REPORTS Casing Guard
        id: casing_check
        run: |
          chmod +x scripts/check_reports_casing.sh
          if ./scripts/check_reports_casing.sh; then
            echo "check_result=success" >> $GITHUB_OUTPUT
            echo "ğŸ‰ REPORTS ì¼€ì´ìŠ¤ ê·œì¹™ ì¤€ìˆ˜ í™•ì¸!"
          else
            echo "check_result=failure" >> $GITHUB_OUTPUT
            echo "âŒ ì†Œë¬¸ì reports/ ê²½ë¡œ ë°œê²¬ - PR ì°¨ë‹¨!"
            exit 1
          fi
        continue-on-error: false

      - name: Comment on PR (ì‹¤íŒ¨ ì‹œ)
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const comment = `## ğŸ›¡ï¸ REPORTS Casing Guard ì‹¤íŒ¨

            âŒ **ì†Œë¬¸ì \`reports/\` ê²½ë¡œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤!**

            ### ğŸ“‹ í•´ê²° ë°©ë²•
            1. \`reports/\` â†’ \`REPORTS/\` ê²½ë¡œë¡œ ë³€ê²½
            2. \`git mv reports REPORTS_tmp && git mv REPORTS_tmp REPORTS\`
            3. ë¬¸ì„œì—ì„œ ê²½ë¡œ ì°¸ì¡°ë¥¼ \`REPORTS/\`ë¡œ ìˆ˜ì •

            ### ğŸ“– ìì„¸í•œ ê°€ì´ë“œ
            - [ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ](./MIGRATIONS/2025-09-22-reports-to-REPORTS.md)
            - [ê°œë°œ ê·œì¹™](./README.md#ê°œë°œ-ê·œì¹™)

            ### ğŸ” ê²€ì‚¬ ìŠ¤í¬ë¦½íŠ¸
            ë¡œì»¬ì—ì„œ \`./scripts/check_reports_casing.sh\` ì‹¤í–‰í•˜ì—¬ ë¬¸ì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

            ---
            ğŸ¤– ìë™ ìƒì„±: REPORTS Casing Guard CI`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

      - name: Comment on PR (ì„±ê³µ ì‹œ)
        if: success() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const comment = `## âœ… REPORTS Casing Guard í†µê³¼

            ğŸ‰ **ëª¨ë“  ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ \`REPORTS/\` ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤!**

            ê²½ë¡œ ê·œì¹™ ì¤€ìˆ˜ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì†Œë¬¸ì \`reports/\` ê²½ë¡œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

            ---
            ğŸ¤– ìë™ ìƒì„±: REPORTS Casing Guard CI`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });